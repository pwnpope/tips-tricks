
## What're Calling Conventions?
- Describes how `arguments`  are passed to functions
- Describes how `values are returned` from functions
- Describes if the caller or callee `leans the stack`
- Responsible for function `prologue` and `epilogue`
	- the function `prologue` is a `few lines of code at the beginning of a function`, which prepare the `stack and registers` for use within the function
	- function `epilogue` appears at the end of the function, and `restores the stack` and `registers to the state they were in before` the function was called.
- Different conventions based on processor, OS and language 

---

### cdecl
- **`__cdecl`** is the default calling convention for C and C++ programs. Because the stack is cleaned up by the caller, it can do `vararg` functions.

- args passed on `stack` (right to left)

- caller is responsible for `stack cleanup`

- return value stored in EAX

- NON-volatile registers:  `EBP, ESP, EBX, ESI & EDI`

- supports `vararg` ( `variadic` ) functions

```c
int __cdecl main(int argc, const char **argv, const char **envp)
```
SAME AS:
```asm
push edi ; envp
push esi ; argv
push dword ptr [eax] ; argc
call _main
add esp, 0ch
```

---

### STDCALL

- *same as cdecl* except that the `callee must clean the stack`

- return value stored in EAX

- NON-volatile registers:  `EBP, ESP, EBX, ESI & EDI`


----

### FASTCALL

- The first four parameters are passed in registers, **_LEFT_** to **_RIGHT_**. Parameters that are _**not**_ floating-point values, such as integers, pointers, and chars, will be passed via `RCX, RDX, R8, and R9` (in that order). Floating-point parameters will be passed via XMM0, XMM1, XMM2, and XMM3 (in that order).
- If the parameter being passed is too big to fit in a register then it is passed by reference (a pointer to the data in memory). Parameters can be passed via any sized corresponding register. For example, RCX, ECX, CX, CH, and CL can all be used for the first parameter. Any other parameters are pushed onto the stack, **_RIGHT_** to **_LEFT_**.

- return value stored in EAX

- NON-volatile registers:  `EBP, ESP, EBX, ESI & EDI`
---

### Windows x86 calling conventions

- `all arguments` are `widened` to 32 bits (dword)

- `return value` is `widened` to 32 bits (dword)
- `return values` up to `32 bits` (dword) are returned in `EAX`
- `return values` of `64 bit size` (qword) are returned in `EDX:EAX`

- `return structures` are returned by refrence with a `pointer in EAX`

- registers `ESI, EDI, EBX & EBP` are restored (non-volatile)
	- not changed by function calls
	- (everything else isn't function)
- `MSDN` is your friend


---


